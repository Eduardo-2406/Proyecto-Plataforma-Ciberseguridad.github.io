import{r as E,R as e,b as N,c as f,p as k,u as P,o as D,j as w,k as x}from"./index-BS11OSAT.js";const L=({post:t,onLike:o,onDelete:d,isExpanded:p,onExpand:r,currentUser:c})=>{const[l,s]=E.useState(""),[m,v]=E.useState(!1),g=async n=>{if(n.preventDefault(),!(!l.trim()||!c))try{const a=N(f,`forum/posts/${t.id}/comments`);await k(a,{text:l.trim(),authorId:c.uid,authorName:c.displayName||"Usuario",authorPhoto:c.photoURL||null,timestamp:new Date().toISOString()}),s("")}catch(a){console.error("Error al comentar:",a)}},y=()=>{v(!m),m||r()},u=n=>new Date(n).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),i=n=>({dudas:"Dudas",casos:"Casos",practicas:"Buenas Pr√°cticas"})[n]||n;return e.createElement("div",{className:`post ${p?"expanded":""}`},e.createElement("div",{className:"post-header"},e.createElement("div",{className:"post-author"},e.createElement("img",{src:t.authorPhoto||"/default-avatar.png",alt:t.authorName,className:"author-avatar"}),e.createElement("div",{className:"author-info"},e.createElement("span",{className:"author-name"},t.authorName),e.createElement("span",{className:"post-date"},u(t.timestamp)))),e.createElement("div",{className:"post-category"},i(t.category))),e.createElement("div",{className:"post-content"},e.createElement("h3",null,t.title),e.createElement("p",null,t.content)),e.createElement("div",{className:"post-actions"},e.createElement("button",{className:"action-button like-button",onClick:o,disabled:!c},e.createElement("span",{className:"icon"},"üëç"),e.createElement("span",{className:"count"},t.likes||0)),e.createElement("button",{className:"action-button comment-button",onClick:y},e.createElement("span",{className:"icon"},"üí¨"),e.createElement("span",{className:"count"},t.comments?Object.keys(t.comments).length:0)),c&&c.uid===t.authorId&&e.createElement("button",{className:"action-button delete-button",onClick:d},e.createElement("span",{className:"icon"},"üóëÔ∏è"))),m&&e.createElement("div",{className:"comments-section"},c&&e.createElement("form",{onSubmit:g,className:"comment-form"},e.createElement("textarea",{value:l,onChange:n=>s(n.target.value),placeholder:"Escribe un comentario...",rows:"3",required:!0}),e.createElement("button",{type:"submit",className:"submit-comment"},"Comentar")),e.createElement("div",{className:"comments-list"},t.comments&&Object.entries(t.comments).sort(([,n],[,a])=>new Date(a.timestamp)-new Date(n.timestamp)).map(([n,a])=>e.createElement("div",{key:n,className:"comment"},e.createElement("div",{className:"comment-header"},e.createElement("img",{src:a.authorPhoto||"/default-avatar.png",alt:a.authorName,className:"comment-avatar"}),e.createElement("div",{className:"comment-info"},e.createElement("span",{className:"comment-author"},a.authorName),e.createElement("span",{className:"comment-date"},u(a.timestamp)))),e.createElement("p",{className:"comment-text"},a.text))))))},R=({posts:t,onLike:o,onDelete:d,currentUser:p})=>{const[r,c]=E.useState(null),l=s=>{c(r===s?null:s)};return t.length===0?e.createElement("div",{className:"no-posts"},e.createElement("p",null,"No hay publicaciones en esta categor√≠a."),e.createElement("p",null,"S√© el primero en compartir algo.")):e.createElement("div",{className:"post-list"},t.map(s=>e.createElement(L,{key:s.id,post:s,onLike:()=>o(s.id),onDelete:()=>d(s.id),isExpanded:r===s.id,onExpand:()=>l(s.id),currentUser:p})))},$=({onSubmit:t})=>{const[o,d]=E.useState({title:"",content:"",category:"dudas"}),p=r=>{r.preventDefault(),o.title.trim()&&o.content.trim()&&(t(o),d({title:"",content:"",category:"dudas"}))};return e.createElement("div",{className:"create-post"},e.createElement("h2",null,"Crear Nueva Publicaci√≥n"),e.createElement("form",{onSubmit:p},e.createElement("div",{className:"form-group"},e.createElement("label",{htmlFor:"title"},"T√≠tulo"),e.createElement("input",{type:"text",id:"title",value:o.title,onChange:r=>d({...o,title:r.target.value}),placeholder:"Escribe un t√≠tulo descriptivo",required:!0})),e.createElement("div",{className:"form-group"},e.createElement("label",{htmlFor:"category"},"Categor√≠a"),e.createElement("select",{id:"category",value:o.category,onChange:r=>d({...o,category:r.target.value})},e.createElement("option",{value:"dudas"},"Dudas"),e.createElement("option",{value:"casos"},"Casos"),e.createElement("option",{value:"practicas"},"Buenas Pr√°cticas"))),e.createElement("div",{className:"form-group"},e.createElement("label",{htmlFor:"content"},"Contenido"),e.createElement("textarea",{id:"content",value:o.content,onChange:r=>d({...o,content:r.target.value}),placeholder:"Describe tu duda, caso o buena pr√°ctica...",rows:"6",required:!0})),e.createElement("button",{type:"submit",className:"submit-button"},"Publicar")))},O=()=>{const[t,o]=E.useState([]),[d,p]=E.useState(!0),[r,c]=E.useState(""),[l,s]=E.useState("todos"),{currentUser:m}=P();E.useEffect(()=>{const u=N(f,"forum/posts"),i=D(u,n=>{try{const a=n.val();if(a){const C=Object.entries(a).map(([h,b])=>({id:h,...b,timestamp:new Date(b.timestamp)})).sort((h,b)=>b.timestamp-h.timestamp),S=l==="todos"?C:C.filter(h=>h.category===l);o(S)}p(!1)}catch{c("Error al cargar los posts"),p(!1)}});return()=>i()},[l]);const v=async u=>{if(m)try{const i=N(f,"forum/posts");await k(i,{...u,authorId:m.uid,authorName:m.displayName||"Usuario",authorPhoto:m.photoURL||null,timestamp:new Date().toISOString(),likes:0,comments:[]})}catch{c("Error al crear el post")}},g=async u=>{if(m)try{const i=N(f,`forum/posts/${u}`),n=t.find(a=>a.id===u);await x(i,{likes:(n.likes||0)+1})}catch{c("Error al dar like")}},y=async u=>{if(m)try{const i=N(f,`forum/posts/${u}`);await w(i)}catch{c("Error al eliminar el post")}};return d?e.createElement("div",{className:"forum-container"},e.createElement("div",{className:"loading"},"Cargando foro...")):e.createElement("div",{className:"forum-container"},e.createElement("div",{className:"forum-header"},e.createElement("h1",null,"Foro de Discusi√≥n"),e.createElement("div",{className:"category-filters"},e.createElement("button",{className:`filter-button ${l==="todos"?"active":""}`,onClick:()=>s("todos")},"Todos"),e.createElement("button",{className:`filter-button ${l==="dudas"?"active":""}`,onClick:()=>s("dudas")},"Dudas"),e.createElement("button",{className:`filter-button ${l==="casos"?"active":""}`,onClick:()=>s("casos")},"Casos"),e.createElement("button",{className:`filter-button ${l==="practicas"?"active":""}`,onClick:()=>s("practicas")},"Buenas Pr√°cticas"))),r&&e.createElement("div",{className:"error-message"},r),m&&e.createElement($,{onSubmit:v}),e.createElement(R,{posts:t,onLike:g,onDelete:y,currentUser:m}))};export{O as default};
